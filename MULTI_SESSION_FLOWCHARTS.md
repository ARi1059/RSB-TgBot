# å¤š Session å·¥ä½œæµç¨‹å›¾

> ğŸ“Š å¯è§†åŒ–å±•ç¤ºå¤š Session è´¦å·æ± çš„å·¥ä½œåŸç†å’Œæµç¨‹

## ğŸ¯ ç›®å½•

- [ç³»ç»Ÿæ¶æ„å›¾](#ç³»ç»Ÿæ¶æ„å›¾)
- [è´¦å·é€‰æ‹©æµç¨‹](#è´¦å·é€‰æ‹©æµç¨‹)
- [é™æµæ£€æµ‹ä¸åˆ‡æ¢](#é™æµæ£€æµ‹ä¸åˆ‡æ¢)
- [æ–­ç‚¹ç»­ä¼ æµç¨‹](#æ–­ç‚¹ç»­ä¼ æµç¨‹)
- [çŠ¶æ€ç®¡ç†æµç¨‹](#çŠ¶æ€ç®¡ç†æµç¨‹)
- [æ•°æ®æµå‘å›¾](#æ•°æ®æµå‘å›¾)

---

## ç³»ç»Ÿæ¶æ„å›¾

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     RSB Telegram Bot                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   Bot Core   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤  Admin User  â”‚                â”‚
â”‚  â”‚   (grammY)   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚         â”‚                                                   â”‚
â”‚         â”‚ /session, /transfer                              â”‚
â”‚         â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚        Session Pool Manager                  â”‚         â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚
â”‚  â”‚  â”‚  Session Selection Algorithm           â”‚ â”‚         â”‚
â”‚  â”‚  â”‚  - Priority-based                      â”‚ â”‚         â”‚
â”‚  â”‚  â”‚  - Load balancing                      â”‚ â”‚         â”‚
â”‚  â”‚  â”‚  - Flood wait detection                â”‚ â”‚         â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                                                   â”‚
â”‚         â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚         UserBot Session Pool                â”‚          â”‚
â”‚  â”‚                                             â”‚          â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚          â”‚
â”‚  â”‚  â”‚Session 1 â”‚  â”‚Session 2 â”‚  â”‚Session 3 â”‚ â”‚          â”‚
â”‚  â”‚  â”‚Priority:10â”‚  â”‚Priority:9â”‚  â”‚Priority:5â”‚ â”‚          â”‚
â”‚  â”‚  â”‚ğŸŸ¢ Active â”‚  â”‚ğŸŸ¢ Active â”‚  â”‚ğŸ”´ Flood  â”‚ â”‚          â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚          â”‚
â”‚  â”‚       â”‚             â”‚                       â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚          â”‚             â”‚                                   â”‚
â”‚          â–¼             â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚         Telegram API                        â”‚          â”‚
â”‚  â”‚  - Forward messages                         â”‚          â”‚
â”‚  â”‚  - Get channel history                      â”‚          â”‚
â”‚  â”‚  - Handle flood wait                        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚         PostgreSQL Database                 â”‚          â”‚
â”‚  â”‚  - userbot_sessions                         â”‚          â”‚
â”‚  â”‚  - transfer_tasks                           â”‚          â”‚
â”‚  â”‚  - collections                              â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è´¦å·é€‰æ‹©æµç¨‹

### æ™ºèƒ½é€‰æ‹©ç®—æ³•

```
å¼€å§‹æ¬è¿ä»»åŠ¡
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: æŸ¥è¯¢å¯ç”¨ Session           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SELECT * FROM userbot_sessions     â”‚
â”‚  WHERE is_active = true             â”‚
â”‚    AND is_available = true          â”‚
â”‚    AND (flood_wait_until IS NULL    â”‚
â”‚         OR flood_wait_until < NOW())â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
         æœ‰å¯ç”¨ Sessionï¼Ÿ
         â”œâ”€ å¦ â†’ è¿”å›é”™è¯¯ï¼šæ— å¯ç”¨è´¦å·
         â””â”€ æ˜¯ â†’ ç»§ç»­
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: æŒ‰ä¼˜å…ˆçº§æ’åº               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ORDER BY priority DESC             â”‚
â”‚                                     â”‚
â”‚  ç»“æœç¤ºä¾‹ï¼š                         â”‚
â”‚  - Session 1: Priority 10           â”‚
â”‚  - Session 2: Priority 9            â”‚
â”‚  - Session 4: Priority 5            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: è´Ÿè½½å‡è¡¡                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç›¸åŒä¼˜å…ˆçº§æ—¶ï¼Œé€‰æ‹©                 â”‚
â”‚  daily_transferred æœ€å°‘çš„           â”‚
â”‚                                     â”‚
â”‚  ä¾‹å¦‚ï¼š                             â”‚
â”‚  - Session 1: 1200 æ¬¡               â”‚
â”‚  - Session 2: 1050 æ¬¡ â† é€‰æ‹©è¿™ä¸ª   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: è¿”å›æœ€ä½³ Session           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - Session ID: 2                    â”‚
â”‚  - Priority: 9                      â”‚
â”‚  - Daily transferred: 1050          â”‚
â”‚  - Status: ğŸŸ¢ Available             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
         ä½¿ç”¨è¯¥ Session å¼€å§‹æ¬è¿
```

### é€‰æ‹©å†³ç­–æ ‘

```
                    å¼€å§‹
                     â†“
              æŸ¥è¯¢æ‰€æœ‰ Session
                     â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“                       â†“
    æœ‰ active=trueï¼Ÿ         æ²¡æœ‰
         â†“                       â†“
        æ˜¯                   è¿”å›é”™è¯¯
         â†“
    æœ‰ available=trueï¼Ÿ
         â†“
        æ˜¯
         â†“
    æœ‰æœªé™æµçš„ï¼Ÿ
         â†“
        æ˜¯
         â†“
    æŒ‰ priority æ’åº
         â†“
    å–æœ€é«˜ä¼˜å…ˆçº§ç»„
         â†“
    è¯¥ç»„æœ‰å¤šä¸ªï¼Ÿ
    â”œâ”€ å¦ â†’ è¿”å›è¯¥ Session
    â””â”€ æ˜¯ â†’ æŒ‰ daily_transferred æ’åº
              â†“
         è¿”å›ä½¿ç”¨æœ€å°‘çš„
```

---

## é™æµæ£€æµ‹ä¸åˆ‡æ¢

### é™æµæ£€æµ‹æµç¨‹

```
æ­£åœ¨ä½¿ç”¨ Session 1 æ¬è¿
         â†“
    è½¬å‘æ¶ˆæ¯åˆ° Bot
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ æˆåŠŸï¼Ÿ  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”œâ”€ æ˜¯ â†’ ç»§ç»­ä¸‹ä¸€ä¸ªæ–‡ä»¶
         â””â”€ å¦ â†’ æ£€æŸ¥é”™è¯¯ç±»å‹
                    â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚FloodWait?â”‚
              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                   â”œâ”€ å¦ â†’ è®°å½•é”™è¯¯ï¼Œè·³è¿‡è¯¥æ–‡ä»¶
                   â””â”€ æ˜¯ â†’ è§¦å‘é™æµå¤„ç†
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ é™æµå¤„ç†æµç¨‹        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é™æµå¤„ç†æµç¨‹

```
æ£€æµ‹åˆ° FloodWait é”™è¯¯
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: è§£æç­‰å¾…æ—¶é—´               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  error.seconds = 60                 â”‚
â”‚  (éœ€è¦ç­‰å¾… 60 ç§’)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: æ ‡è®°å½“å‰ Session é™æµ      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  UPDATE userbot_sessions            â”‚
â”‚  SET is_available = false,          â”‚
â”‚      flood_wait_until = NOW() + 60s â”‚
â”‚  WHERE id = 1                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: æŸ¥æ‰¾å…¶ä»–å¯ç”¨ Session       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è°ƒç”¨ getAvailableSession()         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
         æœ‰å…¶ä»–å¯ç”¨ Sessionï¼Ÿ
         â”œâ”€ å¦ â†’ æš‚åœä»»åŠ¡ï¼Œä¿å­˜è¿›åº¦
         â”‚       ç­‰å¾…é™æµè§£é™¤
         â”‚
         â””â”€ æ˜¯ â†’ åˆ‡æ¢åˆ°æ–° Session
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: åˆ‡æ¢ Session               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  oldSessionId = 1                   â”‚
â”‚  newSessionId = 2                   â”‚
â”‚                                     â”‚
â”‚  UPDATE transfer_tasks              â”‚
â”‚  SET current_session_id = 2         â”‚
â”‚  WHERE id = taskId                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 5: é€šçŸ¥ç”¨æˆ·                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å‘é€æ¶ˆæ¯ï¼š                         â”‚
â”‚  "ğŸ”„ å·²åˆ‡æ¢è´¦å·ç»§ç»­æ¬è¿"            â”‚
â”‚  "Session: 1 â†’ 2"                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
         ä½¿ç”¨æ–° Session ç»§ç»­æ¬è¿
```

### è‡ªåŠ¨æ¢å¤æµç¨‹

```
å®šæ—¶ä»»åŠ¡ï¼ˆæ¯åˆ†é’Ÿæ‰§è¡Œï¼‰
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æŸ¥è¯¢é™æµä¸­çš„ Session               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SELECT * FROM userbot_sessions     â”‚
â”‚  WHERE flood_wait_until IS NOT NULL â”‚
â”‚    AND flood_wait_until < NOW()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
         æœ‰éœ€è¦æ¢å¤çš„ï¼Ÿ
         â”œâ”€ å¦ â†’ ç»“æŸ
         â””â”€ æ˜¯ â†’ ç»§ç»­
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¢å¤ Session å¯ç”¨çŠ¶æ€              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  UPDATE userbot_sessions            â”‚
â”‚  SET is_available = true,           â”‚
â”‚      flood_wait_until = NULL        â”‚
â”‚  WHERE id IN (...)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
         è®°å½•æ—¥å¿—ï¼šSession X å·²æ¢å¤
```

---

## æ–­ç‚¹ç»­ä¼ æµç¨‹

### ä»»åŠ¡ä¿å­˜æµç¨‹

```
æ¬è¿ä»»åŠ¡è¿›è¡Œä¸­
         â†“
    é‡åˆ°ä¸­æ–­ï¼ˆé™æµ/æ‰¹æ¬¡å®Œæˆ/é”™è¯¯ï¼‰
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¿å­˜ä»»åŠ¡è¿›åº¦                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  UPDATE transfer_tasks              â”‚
â”‚  SET                                â”‚
â”‚    status = 'paused',               â”‚
â”‚    last_message_id = 12345,         â”‚
â”‚    total_scanned = 1500,            â”‚
â”‚    total_matched = 850,             â”‚
â”‚    total_transferred = 850,         â”‚
â”‚    batch_number = 1,                â”‚
â”‚    current_session_id = 2,          â”‚
â”‚    updated_at = NOW()               â”‚
â”‚  WHERE id = taskId                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
         é€šçŸ¥ç”¨æˆ·ï¼šä»»åŠ¡å·²æš‚åœ
         æ˜¾ç¤ºè¿›åº¦å’Œæ¢å¤é€‰é¡¹
```

### ä»»åŠ¡æ¢å¤æµç¨‹

```
ç”¨æˆ·ç‚¹å‡» "ç»§ç»­ä»»åŠ¡"
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: åŠ è½½ä»»åŠ¡ä¿¡æ¯               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SELECT * FROM transfer_tasks       â”‚
â”‚  WHERE id = taskId                  â”‚
â”‚                                     â”‚
â”‚  è·å–ï¼š                             â”‚
â”‚  - last_message_id: 12345           â”‚
â”‚  - current_session_id: 2            â”‚
â”‚  - config: {...}                    â”‚
â”‚  - ç»Ÿè®¡ä¿¡æ¯                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: æ¢å¤ Session               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å°è¯•ä½¿ç”¨ current_session_id        â”‚
â”‚  å¦‚æœä¸å¯ç”¨ï¼Œé€‰æ‹©æ–°çš„ Session       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: ä»æ–­ç‚¹ç»§ç»­                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  client.iterMessages(channel, {     â”‚
â”‚    offsetId: last_message_id,       â”‚
â”‚    ...                              â”‚
â”‚  })                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
         ç»§ç»­æ¬è¿ï¼Œä¿æŒåŸæœ‰ç»Ÿè®¡
```

---

## çŠ¶æ€ç®¡ç†æµç¨‹

### Session çŠ¶æ€è½¬æ¢å›¾

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Created   â”‚ (æ–°å»º)
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚ æ·»åŠ æˆåŠŸ
                â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”Œâ”€â”€â”€â†’â”‚   Active    â”‚ (æ´»è·ƒ)
    â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â”‚           â”œâ”€ è¢«é€‰ä¸­ä½¿ç”¨
    â”‚           â†“
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    â”‚   In Use    â”‚ (ä½¿ç”¨ä¸­)
    â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â”‚           â”œâ”€ é‡åˆ°é™æµ
    â”‚           â†“
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    â”‚ Flood Wait  â”‚ (é™æµä¸­)
    â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â”‚           â”œâ”€ æ—¶é—´åˆ°
    â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”œâ”€ æ‰‹åŠ¨ç¦ç”¨
                â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Disabled   â”‚ (å·²ç¦ç”¨)
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚ æ‰‹åŠ¨å¯ç”¨
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Active    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä»»åŠ¡çŠ¶æ€è½¬æ¢å›¾

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Pending   â”‚ (å¾…å¤„ç†)
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚ å¼€å§‹æ¬è¿
                â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”Œâ”€â”€â”€â†’â”‚   Running   â”‚ (è¿è¡Œä¸­)
    â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â”‚           â”œâ”€ æ‰¹æ¬¡å®Œæˆ/é™æµ
    â”‚           â†“
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    â”‚   Paused    â”‚ (å·²æš‚åœ)
    â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â”‚           â”œâ”€ ç»§ç»­ä»»åŠ¡
    â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”œâ”€ å®Œæˆ
                â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Completed  â”‚ (å·²å®Œæˆ)
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”œâ”€ é‡åˆ°é”™è¯¯
                â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Failed    â”‚ (å¤±è´¥)
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ•°æ®æµå‘å›¾

### æ¬è¿ä»»åŠ¡æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin User  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ /transfer
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Bot: transferFlow               â”‚
â”‚  - æ”¶é›†é…ç½®å‚æ•°                  â”‚
â”‚  - åˆ›å»ºä»»åŠ¡è®°å½•                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ é…ç½®å‚æ•°
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UserBot: startTransfer()        â”‚
â”‚  - é€‰æ‹© Session                  â”‚
â”‚  - å¼€å§‹æ‰«æé¢‘é“                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ æ¶ˆæ¯åˆ—è¡¨
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿‡æ»¤å’ŒåŒ¹é…                      â”‚
â”‚  - æ—¥æœŸèŒƒå›´                      â”‚
â”‚  - å†…å®¹ç±»å‹                      â”‚
â”‚  - å…³é”®å­—                        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ åŒ¹é…çš„æ¶ˆæ¯
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è½¬å‘åˆ° Bot                      â”‚
â”‚  - client.forwardMessages()      â”‚
â”‚  - é€Ÿç‡æ§åˆ¶                      â”‚
â”‚  - é™æµæ£€æµ‹                      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ è½¬å‘ç»“æœ
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Bot: transferExecuteFlow        â”‚
â”‚  - æ¥æ”¶è½¬å‘çš„åª’ä½“               â”‚
â”‚  - ä¿å­˜åˆ°æ•°æ®åº“                  â”‚
â”‚  - åˆ›å»ºåˆé›†                      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ åˆé›†ä¿¡æ¯
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database                        â”‚
â”‚  - collections                   â”‚
â”‚  - media_files                   â”‚
â”‚  - transfer_tasks                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ å®Œæˆé€šçŸ¥
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin User  â”‚
â”‚  æ”¶åˆ°åˆé›†é“¾æ¥â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Session ç®¡ç†æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin User  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ /session
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Bot: sessionManageFlow          â”‚
â”‚  - æ˜¾ç¤ºç®¡ç†èœå•                  â”‚
â”‚  - å¤„ç†ç”¨æˆ·æ“ä½œ                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ æ·»åŠ è´¦å·
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ”¶é›†è´¦å·ä¿¡æ¯                    â”‚
â”‚  - è´¦å·åç§°                      â”‚
â”‚  - API ID / Hash                 â”‚
â”‚  - ä¼˜å…ˆçº§                        â”‚
â”‚  - æ‰‹æœºå·                        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ ç™»å½•éªŒè¯
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UserBot: createNewSession()     â”‚
â”‚  - å‘é€éªŒè¯ç                     â”‚
â”‚  - éªŒè¯ç™»å½•                      â”‚
â”‚  - ç”Ÿæˆ session_string           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ session_string
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SessionPool: addSession()       â”‚
â”‚  - ä¿å­˜åˆ°æ•°æ®åº“                  â”‚
â”‚  - åˆå§‹åŒ–çŠ¶æ€                    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ æˆåŠŸ
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database: userbot_sessions      â”‚
â”‚  - æ–°è®°å½•å·²åˆ›å»º                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ ç¡®è®¤æ¶ˆæ¯
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin User  â”‚
â”‚  è´¦å·æ·»åŠ æˆåŠŸâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹

### åœºæ™¯ï¼šå¤§è§„æ¨¡æ¬è¿ä»»åŠ¡

```
æ—¶é—´è½´ï¼š

T0: ç”¨æˆ·å‘èµ·æ¬è¿ä»»åŠ¡
    â”œâ”€ é…ç½®ï¼šæ¬è¿ 5000 ä¸ªæ–‡ä»¶
    â”œâ”€ ç³»ç»Ÿé€‰æ‹© Session 1 (Priority 10)
    â””â”€ å¼€å§‹æ¬è¿

T1: æ¬è¿ 850 ä¸ªæ–‡ä»¶å
    â”œâ”€ Session 1 è§¦å‘é™æµ
    â”œâ”€ ç³»ç»Ÿè‡ªåŠ¨åˆ‡æ¢åˆ° Session 2 (Priority 9)
    â””â”€ ç»§ç»­æ¬è¿

T2: æ¬è¿ 1700 ä¸ªæ–‡ä»¶å
    â”œâ”€ Session 2 è§¦å‘é™æµ
    â”œâ”€ ç³»ç»Ÿè‡ªåŠ¨åˆ‡æ¢åˆ° Session 3 (Priority 8)
    â””â”€ ç»§ç»­æ¬è¿

T3: æ¬è¿ 2500 ä¸ªæ–‡ä»¶å
    â”œâ”€ Session 3 è§¦å‘é™æµ
    â”œâ”€ ç³»ç»Ÿè‡ªåŠ¨åˆ‡æ¢åˆ° Session 4 (Priority 5)
    â””â”€ ç»§ç»­æ¬è¿

T4: æ¬è¿ 3200 ä¸ªæ–‡ä»¶å
    â”œâ”€ Session 4 è§¦å‘é™æµ
    â”œâ”€ Session 1 é™æµå·²è§£é™¤ï¼ˆ60ç§’åï¼‰
    â”œâ”€ ç³»ç»Ÿåˆ‡æ¢å› Session 1
    â””â”€ ç»§ç»­æ¬è¿

T5: æ¬è¿ 4000 ä¸ªæ–‡ä»¶å
    â”œâ”€ è¾¾åˆ°æ‰¹æ¬¡é™åˆ¶ï¼ˆBATCH_SIZE: 300ï¼‰
    â”œâ”€ ç³»ç»Ÿæš‚åœä»»åŠ¡
    â”œâ”€ ä¿å­˜è¿›åº¦
    â””â”€ é€šçŸ¥ç”¨æˆ·

T6: ç”¨æˆ·ç»§ç»­ä»»åŠ¡
    â”œâ”€ ä» last_message_id ç»§ç»­
    â”œâ”€ ä½¿ç”¨å¯ç”¨çš„ Session
    â””â”€ å®Œæˆå‰©ä½™ 1000 ä¸ªæ–‡ä»¶

T7: ä»»åŠ¡å®Œæˆ
    â”œâ”€ åˆ›å»ºåˆé›†
    â”œâ”€ ç”Ÿæˆæ·±é“¾æ¥
    â””â”€ é€šçŸ¥ç”¨æˆ·
```

### æµç¨‹å›¾

```
å¼€å§‹
  â†“
é€‰æ‹© Session 1
  â†“
æ¬è¿ 850 ä¸ª â”€â”€é™æµâ”€â”€â†’ åˆ‡æ¢åˆ° Session 2
  â†“
æ¬è¿ 850 ä¸ª â”€â”€é™æµâ”€â”€â†’ åˆ‡æ¢åˆ° Session 3
  â†“
æ¬è¿ 800 ä¸ª â”€â”€é™æµâ”€â”€â†’ åˆ‡æ¢åˆ° Session 4
  â†“
æ¬è¿ 700 ä¸ª â”€â”€é™æµâ”€â”€â†’ Session 1 å·²æ¢å¤
  â†“                    â†“
æ¬è¿ 800 ä¸ª â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
è¾¾åˆ°æ‰¹æ¬¡é™åˆ¶
  â†“
æš‚åœå¹¶ä¿å­˜
  â†“
ç”¨æˆ·ç»§ç»­
  â†“
æ¬è¿ 1000 ä¸ª
  â†“
å®Œæˆ
```

---

## ğŸ“Š æ€§èƒ½ç›‘æ§æµç¨‹

### å®æ—¶ç›‘æ§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç›‘æ§å¾ªç¯ï¼ˆæ¯ 10 ç§’ï¼‰               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  1. æŸ¥è¯¢æ‰€æœ‰ Session çŠ¶æ€           â”‚
â”‚     â”œâ”€ å¯ç”¨æ•°é‡                     â”‚
â”‚     â”œâ”€ é™æµæ•°é‡                     â”‚
â”‚     â””â”€ ä½¿ç”¨æƒ…å†µ                     â”‚
â”‚                                     â”‚
â”‚  2. æŸ¥è¯¢æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡              â”‚
â”‚     â”œâ”€ ä»»åŠ¡æ•°é‡                     â”‚
â”‚     â”œâ”€ è¿›åº¦ç»Ÿè®¡                     â”‚
â”‚     â””â”€ ä½¿ç”¨çš„ Session               â”‚
â”‚                                     â”‚
â”‚  3. æ£€æŸ¥å¼‚å¸¸æƒ…å†µ                    â”‚
â”‚     â”œâ”€ æ‰€æœ‰ Session é™æµ            â”‚
â”‚     â”œâ”€ ä»»åŠ¡é•¿æ—¶é—´æ— è¿›åº¦             â”‚
â”‚     â””â”€ æ•°æ®åº“è¿æ¥å¼‚å¸¸               â”‚
â”‚                                     â”‚
â”‚  4. è®°å½•æ—¥å¿—å’ŒæŒ‡æ ‡                  â”‚
â”‚     â”œâ”€ è½¬å‘é€Ÿç‡                     â”‚
â”‚     â”œâ”€ é™æµé¢‘ç‡                     â”‚
â”‚     â””â”€ Session ä½¿ç”¨åˆ†å¸ƒ             â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [MULTI_SESSION_GUIDE.md](MULTI_SESSION_GUIDE.md) - åŠŸèƒ½è¯¦ç»†æŒ‡å—
- [MULTI_SESSION_TUTORIAL.md](MULTI_SESSION_TUTORIAL.md) - å®æˆ˜æ•™ç¨‹
- [MULTI_SESSION_DATABASE_EXAMPLES.md](MULTI_SESSION_DATABASE_EXAMPLES.md) - æ•°æ®åº“ç¤ºä¾‹
- [MULTI_SESSION_FAQ.md](MULTI_SESSION_FAQ.md) - å¸¸è§é—®é¢˜è§£ç­”

---

**æœ€åæ›´æ–°ï¼š** 2026-02-21
**ç‰ˆæœ¬ï¼š** v1.0.0

**ç¥ä½¿ç”¨æ„‰å¿«ï¼** ğŸš€
