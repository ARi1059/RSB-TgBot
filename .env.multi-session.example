# ========================================
# RSB-Tgbot 多 Session 配置示例
# ========================================
#
# 本文件展示如何配置多个 Telegram UserBot Session
# 用于大规模搬运任务和限流规避
#
# 使用说明：
# 1. 这是一个配置示例，展示多 Session 的最佳实践
# 2. 实际使用时，建议通过 Bot 的 /session 命令管理账号
# 3. 环境变量配置仅用于默认 session（向后兼容）
#

# ========================================
# 环境标识（必填）
# ========================================
NODE_ENV=production

# ========================================
# Telegram Bot 配置（必填）
# ========================================

# Bot Token - 从 @BotFather 获取
BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz1234567890

# Bot 用户名（不含 @）
BOT_USERNAME=your_bot_username

# ========================================
# 管理员配置（必填）
# ========================================

# 管理员 Telegram ID（多个用逗号分隔）
# 获取方式：发送消息给 @userinfobot
ADMIN_IDS=123456789,987654321

# 管理员联系方式（用于权限升级提示）
ADMIN_CONTACT=@your_admin_username

# ========================================
# 数据库配置（必填）
# ========================================

# PostgreSQL 连接字符串
DATABASE_URL=postgresql://rsb_user:password@localhost:5432/rsb_tgbot?schema=public

# ========================================
# 频道配置（可选）
# ========================================

# 私密频道 ID（用于发布合集）
PRIVATE_CHANNEL_ID=-1001234567890

# ========================================
# 代理配置（可选）
# ========================================
#
# 开发环境（中国大陆）：需要配置代理
# 生产环境（海外服务器）：通常不需要代理
#
# HTTP_PROXY=http://127.0.0.1:7890
# HTTPS_PROXY=http://127.0.0.1:7890

# ========================================
# Userbot 默认 Session 配置（可选）
# ========================================
#
# 多 Session 架构说明：
# - 新版本使用数据库管理多个 session
# - 通过 Bot 的 /session 命令添加和管理账号
# - 系统会自动选择可用的 session 并在限流时切换
#
# 向后兼容（可选）：
# 如果配置了以下环境变量，系统会优先使用这个默认 session
# 建议：新用户直接通过 Bot 管理 session，无需配置以下变量
#
# USERBOT_API_ID=12345678
# USERBOT_API_HASH=abcdef1234567890abcdef1234567890
# USERBOT_SESSION=1BQANOTEuMTA4LjU2LjExMwG7QvgQjqoRHUNdfdDIpYRHl40ulWIpUjwTeDMzv5m87XAGgLqrbpgk3291MDLTAOM0HxMM7juXTQPwmCnzofNT+Dt5tdP/2jCtBsjgObnEzg1zIMGvvPNgQDzexv67cjIBdisRaKH8uw209Go9dI/G1WcV1zjlpuOb0q8gyOa//dTJXVAI2gHz8gAGn5sXcJSPYqt0CDpHVKna3vnOCMyoGuI0fgG6WhMq3ZSuCbNMTZeA5sPHuvQtqVL4q1/DdkQG/jP3/++CBxvDTTh1kgTp+sgbEj1VbnXnRfBmJLyxwEIlmq146Rz17SOZJ7JFCew3X7xfFUGJ+ykKcsmS6eWqmA==


# ========================================
# 多 Session 配置指南
# ========================================
#
# 以下是通过 Bot 管理多个 Session 的完整指南
#

# ----------------------------------------
# 步骤 1：准备多个 Telegram 账号
# ----------------------------------------
#
# 每个 Session 需要一个独立的 Telegram 账号：
#
# 账号 1（主力账号）：
#   - 手机号：+86 138 0013 8000
#   - 用途：主要搬运任务
#   - 优先级：10（最高）
#
# 账号 2（主力账号）：
#   - 手机号：+86 138 0013 8001
#   - 用途：主要搬运任务
#   - 优先级：9
#
# 账号 3（备用账号）：
#   - 手机号：+86 138 0013 8002
#   - 用途：限流时切换
#   - 优先级：5
#
# 账号 4（备用账号）：
#   - 手机号：+86 138 0013 8003
#   - 用途：限流时切换
#   - 优先级：3
#
# 账号 5（应急账号）：
#   - 手机号：+86 138 0013 8004
#   - 用途：所有账号限流时使用
#   - 优先级：1

# ----------------------------------------
# 步骤 2：为每个账号申请 API ID
# ----------------------------------------
#
# 访问 https://my.telegram.org/apps
#
# 账号 1 的 API 凭证：
#   API ID: 12345678
#   API Hash: abcdef1234567890abcdef1234567890
#
# 账号 2 的 API 凭证：
#   API ID: 23456789
#   API Hash: bcdef1234567890abcdef12345678901
#
# 账号 3 的 API 凭证：
#   API ID: 34567890
#   API Hash: cdef1234567890abcdef123456789012
#
# 账号 4 的 API 凭证：
#   API ID: 45678901
#   API Hash: def1234567890abcdef1234567890123
#
# 账号 5 的 API 凭证：
#   API ID: 56789012
#   API Hash: ef1234567890abcdef12345678901234

# ----------------------------------------
# 步骤 3：通过 Bot 添加 Session
# ----------------------------------------
#
# 在 Telegram 中操作：
#
# 1. 启动 Bot，发送 /session 命令
# 2. 点击 [➕ 添加新账号]
# 3. 按提示输入每个账号的信息：
#
# 添加账号 1（主力）：
#   账号名称：主力账号1
#   API ID：12345678
#   API Hash：abcdef1234567890abcdef1234567890
#   优先级：10
#   手机号：+8613800138000
#   验证码：（收到的验证码）
#   两步验证密码：（如果有）
#
# 添加账号 2（主力）：
#   账号名称：主力账号2
#   API ID：23456789
#   API Hash：bcdef1234567890abcdef12345678901
#   优先级：9
#   手机号：+8613800138001
#   验证码：（收到的验证码）
#   两步验证密码：（如果有）
#
# 添加账号 3（备用）：
#   账号名称：备用账号1
#   API ID：34567890
#   API Hash：cdef1234567890abcdef123456789012
#   优先级：5
#   手机号：+8613800138002
#   验证码：（收到的验证码）
#   两步验证密码：（如果有）
#
# 添加账号 4（备用）：
#   账号名称：备用账号2
#   API ID：45678901
#   API Hash：def1234567890abcdef1234567890123
#   优先级：3
#   手机号：+8613800138003
#   验证码：（收到的验证码）
#   两步验证密码：（如果有）
#
# 添加账号 5（应急）：
#   账号名称：应急账号
#   API ID：56789012
#   API Hash：ef1234567890abcdef12345678901234
#   优先级：1
#   手机号：+8613800138004
#   验证码：（收到的验证码）
#   两步验证密码：（如果有）

# ----------------------------------------
# 步骤 4：验证配置
# ----------------------------------------
#
# 1. 查看账号列表：
#    /session → [📋 查看账号列表]
#
# 2. 确认所有账号状态：
#    ✅ 🟢 #1 主力账号1
#    ✅ 🟢 #2 主力账号2
#    ✅ 🟢 #3 备用账号1
#    ✅ 🟢 #4 备用账号2
#    ✅ 🟢 #5 应急账号
#
# 3. 查看统计信息：
#    /session → [📊 账号统计]

# ----------------------------------------
# 步骤 5：测试自动切换
# ----------------------------------------
#
# 1. 开始一个搬运任务：/transfer
# 2. 观察进度消息中的 Session ID
# 3. 系统会自动：
#    - 优先使用优先级高的账号
#    - 检测到限流时自动切换
#    - 记录每个账号的使用情况
#    - 限流解除后自动恢复可用状态

# ========================================
# 配置方案对比
# ========================================

# ----------------------------------------
# 方案 A：单 Session（最简单）
# ----------------------------------------
#
# 适用场景：
# - 个人使用，偶尔搬运
# - 每天搬运 < 500 个文件
# - 可以接受限流等待
#
# 配置：
# - 保持环境变量配置
# - 或通过 Bot 添加 1 个账号
#
# 优点：
# - 配置简单
# - 维护成本低
#
# 缺点：
# - 遇到限流需要等待
# - 效率较低

# ----------------------------------------
# 方案 B：混合模式（推荐新手）
# ----------------------------------------
#
# 适用场景：
# - 小团队使用
# - 每天搬运 500-2000 个文件
# - 需要一定的可靠性
#
# 配置：
# - 环境变量配置 1 个默认账号
# - 通过 Bot 添加 1-2 个备用账号
#
# 优点：
# - 兼顾简单性和可靠性
# - 平滑过渡
#
# 缺点：
# - 仍可能遇到所有账号限流

# ----------------------------------------
# 方案 C：多 Session（推荐生产）
# ----------------------------------------
#
# 适用场景：
# - 商业使用
# - 每天搬运 > 2000 个文件
# - 需要高可用性
#
# 配置：
# - 不使用环境变量配置
# - 通过 Bot 添加 3-5 个账号
# - 设置不同优先级
#
# 优点：
# - 最佳性能
# - 几乎不受限流影响
# - 可以 24/7 运行
#
# 缺点：
# - 需要多个手机号
# - 配置较复杂
# - 需要管理多个账号

# ========================================
# 推荐配置参数
# ========================================

# ----------------------------------------
# 小规模使用（< 1000 文件/天）
# ----------------------------------------
#
# Session 配置：
# - 账号数量：2 个
# - 主力账号：1 个（priority=10）
# - 备用账号：1 个（priority=5）
#
# 速率配置（在代码中修改 src/constants/index.ts）：
# TRANSFER_CONFIG = {
#   BATCH_SIZE: 500,
#   FORWARD_RATE: 1500,
#   PAUSE_AFTER_FILES: 50,
#   PAUSE_DURATION: 15000,
#   LONG_PAUSE_AFTER_FILES: 200,
#   LONG_PAUSE_DURATION: 60000,
#   PROGRESS_UPDATE_INTERVAL: 10
# }

# ----------------------------------------
# 中规模使用（1000-5000 文件/天）
# ----------------------------------------
#
# Session 配置：
# - 账号数量：4 个
# - 主力账号：2 个（priority=10, 9）
# - 备用账号：2 个（priority=5, 3）
#
# 速率配置：
# TRANSFER_CONFIG = {
#   BATCH_SIZE: 300,
#   FORWARD_RATE: 2000,
#   PAUSE_AFTER_FILES: 30,
#   PAUSE_DURATION: 20000,
#   LONG_PAUSE_AFTER_FILES: 120,
#   LONG_PAUSE_DURATION: 90000,
#   PROGRESS_UPDATE_INTERVAL: 10
# }

# ----------------------------------------
# 大规模使用（> 5000 文件/天）
# ----------------------------------------
#
# Session 配置：
# - 账号数量：5-8 个
# - 主力账号：3 个（priority=10, 9, 8）
# - 备用账号：3 个（priority=5, 4, 3）
# - 应急账号：1-2 个（priority=1, 0）
#
# 速率配置：
# TRANSFER_CONFIG = {
#   BATCH_SIZE: 200,
#   FORWARD_RATE: 2500,
#   PAUSE_AFTER_FILES: 20,
#   PAUSE_DURATION: 30000,
#   LONG_PAUSE_AFTER_FILES: 80,
#   LONG_PAUSE_DURATION: 180000,
#   PROGRESS_UPDATE_INTERVAL: 5
# }

# ========================================
# 安全建议
# ========================================
#
# 1. 保护 Session 数据
#    - Session String 相当于账号密码
#    - 定期备份数据库
#    - 限制数据库访问权限
#    - 使用强密码
#
# 2. 账号安全
#    - 启用两步验证
#    - 使用真实手机号（避免虚拟号被封）
#    - 不要共享账号
#    - 定期检查账号状态
#
# 3. 合规使用
#    - 遵守 Telegram ToS
#    - 不要用于垃圾信息
#    - 尊重频道版权
#    - 控制搬运速率
#
# 4. 数据安全
#    - 不要在公共环境运行
#    - 使用 HTTPS 连接数据库
#    - 定期更新依赖
#    - 监控异常活动

# ========================================
# 监控和维护
# ========================================
#
# 每日检查：
# 1. 查看账号状态：/session → [📋 查看账号列表]
# 2. 检查限流情况
# 3. 查看转发统计
#
# 每周检查：
# 1. 查看总体统计：/session → [📊 账号统计]
# 2. 评估账号健康度
# 3. 调整优先级（如需要）
# 4. 清理无效账号
#
# 异常处理：
# 1. 账号被限流：系统自动切换，无需干预
# 2. 所有账号限流：等待或添加新账号
# 3. 账号被封禁：删除该账号，添加新账号
# 4. 登录失效：重新登录验证

# ========================================
# 故障排查
# ========================================
#
# 问题 1：无法添加账号
# 原因：API 凭证错误
# 解决：检查 API ID 和 API Hash 是否正确
#
# 问题 2：所有账号限流
# 原因：速率过快或账号质量差
# 解决：降低 FORWARD_RATE，使用真实活跃账号
#
# 问题 3：账号频繁限流
# 原因：新账号或异常账号
# 解决：使用真实活跃的账号，避免新注册账号
#
# 问题 4：切换失败
# 原因：无可用账号
# 解决：添加更多账号或等待限流解除
#
# 问题 5：登录失败
# 原因：验证码错误或网络问题
# 解决：检查验证码，确认代理配置

# ========================================
# 相关文档
# ========================================
#
# - README.md - 项目总览和完整文档
# - .env.example - 基础环境变量配置示例

# ========================================
# 技术支持
# ========================================
#
# 遇到问题？
# 1. 查看日志：tail -f logs/app.log
# 2. 检查配置：确认 .env 和数据库配置
# 3. 查看文档：阅读 README.md
# 4. 提交 Issue：在 GitHub 上报告问题
#
# GitHub: https://github.com/ARi1059/RSB-TgBot
